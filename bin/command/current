#!/usr/bin/env bash

set -euo pipefail

source ${LUVER_SRC}/bin/command/util/extract_luarocks_version

function luver_current_lua() {
  if ! test -d "${LUVER_CURRENT_DIR}"; then
    exit 1
  fi

  local current_version=$(realpath "${LUVER_CURRENT_DIR}")
  current_version="${current_version%/*}"
  current_version="${current_version##*/}"

  echo "${current_version}"
}

function luver_current_luarocks() {
  local -r lua_version="$(luver_current_lua)"
  extract_luarocks_version "${lua_version}"
}

function luver_current() {
  local tool="${1:-"lua"}"
  if [[ " lua luarocks " != *" ${tool} "* ]]; then
    echo "unsupported tool: ${tool}"
    exit 1
  fi

  luver_current_${tool} $@
}

luver_current $@
